<!-- Fixed header -->
<header class="fixed top-0 z-50 w-full min-h-16 border-b border-border bg-card shadow-sm">
    <div class="w-site mx-auto px-4 lg:px-6">
        <div class="flex items-center justify-between w-full min-h-16">
            <!-- Logo and Title -->
            <div class="flex items-center gap-4">
                <a href="{{ url_for('web.web_public.home.index') }}" class="flex items-center gap-2">
                    <!-- Full title on desktop/tablet -->
                    <span class="hidden sm:block text-xl sm:text-2xl font-bold text-primary">{{ site_title }}</span>
                    <!-- Acronym on mobile -->
                    <span class="sm:hidden text-xl font-bold text-primary">ANC</span>
                </a>
            </div>
            
            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center gap-6">
                <a href="{{ url_for('web.web_public.home.index') }}" 
                   class="text-sm font-medium text-foreground hover:text-primary transition-colors">
                    Home
                </a>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('web.web_public.calculator.index') }}" 
                       class="text-sm font-medium text-foreground hover:text-primary transition-colors">
                        Calculator
                    </a>
                    <a href="{{ url_for('web.web_public.calculator.attempts') }}" 
                       class="text-sm font-medium text-foreground hover:text-primary transition-colors">
                        My Attempts
                    </a>
                    <a href="{{ url_for('web.web_public.settings.index') }}" 
                       class="text-sm font-medium text-foreground hover:text-primary transition-colors">
                        Settings
                    </a>
                {% endif %}
                <a href="{{ url_for('web.web_public.contact.index') }}" 
                   class="text-sm font-medium text-foreground hover:text-primary transition-colors">
                    Contact
                </a>
            </nav>
            
            <!-- Desktop Auth/Actions -->
            <div class="hidden md:flex items-center gap-3">
                {% if current_user.is_authenticated %}
                    <div class="relative group">
                        <button type="button"
                                class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-muted transition-colors"
                                id="user-menu-button">
                            <div class="w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold">
                                {% if CURRENT_USER and CURRENT_USER.firstname %}
                                    {{ CURRENT_USER.firstname[0]|upper }}
                                {% else %}
                                    {{ current_user.username[0]|upper if current_user.username else 'U' }}
                                {% endif %}
                            </div>
                            <span class="text-sm font-medium text-foreground">
                                {% if CURRENT_USER and CURRENT_USER.firstname %}
                                    {{ CURRENT_USER.firstname }}
                                {% else %}
                                    {{ current_user.username }}
                                {% endif %}
                            </span>
                            <i class="bx bx-chevron-down text-gray-500"></i>
                        </button>
                        <div class="absolute right-0 mt-0 w-48 bg-card border border-border rounded-lg shadow-lg hidden group-hover:block z-50">
                            <div class="py-1">
                                <a href="{{ url_for('web.web_public.settings.index') }}" 
                                   class="block px-4 py-2 text-sm text-foreground hover:bg-muted">
                                    Settings
                                </a>
                                <a href="{{ url_for('web.web_public.auth.logout') }}" 
                                   class="block px-4 py-2 text-sm text-foreground hover:bg-muted">
                                    Sign out
                                </a>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <a href="{{ url_for('web.web_public.auth.login') }}" 
                       class="px-4 py-2 text-sm font-medium text-foreground hover:text-primary transition-colors">
                        Login
                    </a>
                    <a href="{{ url_for('web.web_public.auth.register') }}" 
                       class="px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors">
                        Sign Up
                    </a>
                {% endif %}
            </div>
            
            <!-- Mobile Menu Button -->
            <button type="button" 
                    id="mobile-menu-button"
                    class="md:hidden p-2 rounded-lg text-foreground hover:bg-muted transition-colors focus:outline-none focus:ring-2 focus:ring-primary"
                    aria-label="Toggle menu"
                    aria-expanded="false">
                <i class="bx bx-menu text-2xl" id="menu-icon"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Backdrop -->
    <div id="mobile-menu-backdrop" 
         class="md:hidden fixed inset-0 bg-black/50 z-40 opacity-0 pointer-events-none transition-opacity duration-300"
         style="display: none;"></div>
    
    <!-- Mobile Menu Sheet (slides from right) -->
    <div id="mobile-menu" 
         class="md:hidden fixed top-16 right-0 h-[calc(100vh-4rem)] w-80 max-w-[85vw] bg-card border-l border-border shadow-xl z-50 transform transition-transform duration-300 ease-in-out overflow-y-auto"
         style="transform: translateX(100%);">
        <div class="px-4 py-6 h-full">
            <nav class="flex flex-col gap-1 h-full">
                <a href="{{ url_for('web.web_public.home.index') }}" 
                   class="flex items-center gap-3 px-4 py-3 text-base font-medium text-foreground hover:bg-muted rounded-lg transition-colors"
                   onclick="window.closeMobileMenu && window.closeMobileMenu()">
                    <i class="bx bx-home text-xl"></i>
                    <span>Home</span>
                </a>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('web.web_public.calculator.index') }}" 
                       class="flex items-center gap-3 px-4 py-3 text-base font-medium text-foreground hover:bg-muted rounded-lg transition-colors"
                       onclick="window.closeMobileMenu && window.closeMobileMenu()">
                        <i class="bx bx-calculator text-xl"></i>
                        <span>Calculator</span>
                    </a>
                    <a href="{{ url_for('web.web_public.calculator.attempts') }}" 
                       class="flex items-center gap-3 px-4 py-3 text-base font-medium text-foreground hover:bg-muted rounded-lg transition-colors"
                       onclick="window.closeMobileMenu && window.closeMobileMenu()">
                        <i class="bx bx-history text-xl"></i>
                        <span>My Attempts</span>
                    </a>
                    <a href="{{ url_for('web.web_public.settings.index') }}" 
                       class="flex items-center gap-3 px-4 py-3 text-base font-medium text-foreground hover:bg-muted rounded-lg transition-colors"
                       onclick="window.closeMobileMenu && window.closeMobileMenu()">
                        <i class="bx bx-cog text-xl"></i>
                        <span>Settings</span>
                    </a>
                {% endif %}
                <a href="{{ url_for('web.web_public.contact.index') }}" 
                   class="flex items-center gap-3 px-4 py-3 text-base font-medium text-foreground hover:bg-muted rounded-lg transition-colors"
                   onclick="window.closeMobileMenu && window.closeMobileMenu()">
                    <i class="bx bx-envelope text-xl"></i>
                    <span>Contact</span>
                </a>
                
                <!-- Mobile Auth Section -->
                <div class="mt-auto pt-4 border-t border-border">
                    {% if current_user.is_authenticated %}
                        <div class="flex items-center gap-3 px-4 py-3 bg-muted rounded-lg mb-4">
                            <div class="w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold shrink-0">
                                {% if CURRENT_USER and CURRENT_USER.firstname %}
                                    {{ CURRENT_USER.firstname[0]|upper }}
                                {% else %}
                                    {{ current_user.username[0]|upper if current_user.username else 'U' }}
                                {% endif %}
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-semibold text-foreground truncate">
                                    {% if CURRENT_USER and CURRENT_USER.firstname %}
                                        {{ CURRENT_USER.firstname }} {{ CURRENT_USER.lastname if CURRENT_USER.lastname else '' }}
                                    {% else %}
                                        {{ current_user.username }}
                                    {% endif %}
                                </p>
                                <p class="text-xs text-muted-foreground truncate">{{ current_user.email }}</p>
                            </div>
                        </div>
                        <a href="{{ url_for('web.web_public.settings.index') }}" 
                           class="flex items-center gap-3 px-4 py-3 text-base font-medium text-foreground hover:bg-muted rounded-lg transition-colors mb-2"
                           onclick="window.closeMobileMenu && window.closeMobileMenu()">
                            <i class="bx bx-user text-xl"></i>
                            <span>Profile Settings</span>
                        </a>
                        <a href="{{ url_for('web.web_public.auth.logout') }}" 
                           class="flex items-center gap-3 px-4 py-3 text-base font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                           onclick="window.closeMobileMenu && window.closeMobileMenu()">
                            <i class="bx bx-log-out text-xl"></i>
                            <span>Sign out</span>
                        </a>
                    {% else %}
                        <a href="{{ url_for('web.web_public.auth.login') }}" 
                           class="block text-center px-4 py-3 text-base font-medium text-foreground hover:bg-muted border border-border rounded-lg mb-3 transition-colors"
                           onclick="window.closeMobileMenu && window.closeMobileMenu()">
                            Login
                        </a>
                        <a href="{{ url_for('web.web_public.auth.register') }}" 
                           class="block text-center px-4 py-3 text-base font-medium bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors"
                           onclick="window.closeMobileMenu && window.closeMobileMenu()">
                            Sign Up
                        </a>
                    {% endif %}
                </div>
            </nav>
        </div>
    </div>
</header>

<script>
(function() {
    'use strict';
    
    let isMenuOpen = false;
    
    function openMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
        const menuIcon = document.getElementById('menu-icon');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        
        if (!mobileMenu || !mobileMenuBackdrop || !menuIcon) return;
        
        mobileMenu.style.transform = 'translateX(0)';
        mobileMenuBackdrop.style.display = 'block';
        setTimeout(() => {
            mobileMenuBackdrop.style.opacity = '1';
            mobileMenuBackdrop.style.pointerEvents = 'auto';
        }, 10);
        
        menuIcon.classList.remove('bx-menu');
        menuIcon.classList.add('bx-x');
        
        if (mobileMenuButton) {
            mobileMenuButton.setAttribute('aria-expanded', 'true');
        }
        
        document.body.style.overflow = 'hidden';
        isMenuOpen = true;
    }
    
    function closeMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
        const menuIcon = document.getElementById('menu-icon');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        
        if (!mobileMenu || !mobileMenuBackdrop || !menuIcon) return;
        
        mobileMenu.style.transform = 'translateX(100%)';
        mobileMenuBackdrop.style.opacity = '0';
        mobileMenuBackdrop.style.pointerEvents = 'none';
        
        setTimeout(() => {
            mobileMenuBackdrop.style.display = 'none';
        }, 300);
        
        menuIcon.classList.remove('bx-x');
        menuIcon.classList.add('bx-menu');
        
        if (mobileMenuButton) {
            mobileMenuButton.setAttribute('aria-expanded', 'false');
        }
        
        document.body.style.overflow = '';
        isMenuOpen = false;
    }
    
    function toggleMobileMenu() {
        if (isMenuOpen) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }
    
    // Make functions globally available
    window.openMobileMenu = openMobileMenu;
    window.closeMobileMenu = closeMobileMenu;
    window.toggleMobileMenu = toggleMobileMenu;
    
    // Initialize when DOM is ready
    function initMobileMenu() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (!mobileMenuButton || !mobileMenu || !mobileMenuBackdrop) {
            console.warn('Mobile menu elements not found');
            return;
        }
        
        // Ensure menu starts closed
        closeMobileMenu();
        
        // Event listeners
        mobileMenuButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            toggleMobileMenu();
        });
        
        mobileMenuBackdrop.addEventListener('click', function() {
            closeMobileMenu();
        });
        
        // Close menu on window resize if it's open
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768 && isMenuOpen) {
                closeMobileMenu();
            }
        });
        
        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isMenuOpen) {
                closeMobileMenu();
            }
        });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
        // DOM already loaded
        setTimeout(initMobileMenu, 0);
    }
})();
</script>
